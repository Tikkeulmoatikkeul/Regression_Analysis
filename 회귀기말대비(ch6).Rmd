---
title: "회귀기말대비(Ch6)"
author: "doellomdoel"
date: "2024-06-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 0. 데이터 로드 dwaine
```{r}
# 데이터 읽어오기
# url이거나 txt파일인 경우 -> read.table
# csv 파일인 경우 -> read.csv
# 엑셀 파일인 경우 -> read.excel

dwaine<-read.table(
  "http://www.stat.ufl.edu/~rrandles/sta4210/Rclassnotes/data/textdatasets/KutnerData/Chapter%20%206%20Data%20Sets/CH06FI05.txt")


# 컬럼 지정
names(dwaine)<-c("X1","X2","Y")

# 데이터 확인
# 일부
head(dwaine)

# 차원
dim(dwaine)

# 요약
summary(dwaine)
```

## 1. 시각화 pairs, pairs2, 3d
```{r}
# 시각화
pairs(dwaine)


library(ggplot2)
library(GGally)
ggpairs(dwaine)


library(dplyr)
library(plotly)
p <- plot_ly(dwaine, x = ~X1, y = ~X2, z = ~Y,
             colors = c('#BF382A')) %>%
  add_markers() %>%
  layout(scene = list(xaxis = list(title = 'X1'),
                      yaxis = list(title = 'X2'),
                      zaxis = list(title = 'Y')))
p
```

## 2. 선형 회귀 모델 추정
```{r}
# 회귀 계수(bhat) 계산
Y<-dwaine$Y
X<-cbind(1,dwaine$X1, dwaine$X2)
bhat<-solve(t(X)%*%X)%*%t(X)%*%Y
bhat


# lm 함수로 회귀 모델 추정
lm.dwaine<- lm(Y~X1+X2,data=dwaine)
summary(lm.dwaine)


# 예측값(yhat)계산
Yhat<-fitted(lm.dwaine)
Yhat.1<-X%*% bhat

H<-X%*%solve(t(X)%*%X)%*%t(X)
Yhat.2<-H%*%Y

head(cbind(Yhat, Yhat.1, Yhat.2))

plot(Yhat~Y)


# 잔차(예측값(yhat)과 실제값(y) 차이) 계산
Y-Yhat
residuals(lm.dwaine)

# 잔차 시각화
library(ggfortify)
autoplot(lm.dwaine)

# 분산분석(ANOVA)
anova(lm.dwaine)

# 회귀 모델 요약
summary(lm.dwaine)
```


## 3. 예측 구간과 신뢰 구간 계산 
![CI](C:/Users/박경숙/Documents/Rdata/image_chap6/CI.png)
```{r}
# CI
head(predict(lm.dwaine, newdata=dwaine, interval = "confidence"))

predict.lm(lm.dwaine, newdata=data.frame(X1=65.4, X2=17.6), interval="confidence", level=0.95)
```

![PI](C:/Users/박경숙/Documents/Rdata/image_chap6/PI.png)
```{r}
# PI
head(predict(lm.dwaine, newdata=dwaine, interval = "prediction"))

predict.lm(lm.dwaine, newdata=data.frame(X1=65.4, X2=17.6), interval="prediction", level=0.95)
```

## The End
