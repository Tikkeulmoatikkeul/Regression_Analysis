---
title: "ch7_exam_summary"
author: "doellomdoel"
date: "2024-06-10"
output: html_document
---

```{r setup, include=FALSE}
# R code 출력, warning 출력X, 패키지 로드 메세지 출력X

knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## 0. 데이터 로드 bodyfat
```{r}
bodyfat<-read.table(
  "https://users.stat.ufl.edu/~rrandles/sta4210/Rclassnotes/data/textdatasets/KutnerData/Chapter%20%207%20Data%20Sets/CH07TA01.txt")

# 컬럼 지정
names(bodyfat)<-c("X1","X2","X3","Y")

# 데이터 확인
# 일부
head(bodyfat)
tail(bodyfat)

# 차원
dim(bodyfat)

# 요약
summary(bodyfat)
```

## 1. 시각화 pairs, pairs2
```{r}
# 시각화
pairs(bodyfat)
```
```{r}
library(ggplot2)
library(GGally)
ggpairs(bodyfat)
```

## 2. 선형 회귀 모델 추정
#### 2-1. 회귀 계수(bhat) 계산
```{r}
Y<-bodyfat$Y
X<-cbind(1,bodyfat$X1, bodyfat$X2, bodyfat$X3)
bhat<-solve(t(X)%*%X)%*%t(X)%*%Y
bhat
```

#### 2-2. lm 함수로 회귀 모델 추정
##### 2-2-1. Y~X1
```{r}
lm1<-lm(Y~X1, data=bodyfat)
coef(summary(lm1))
anova(lm1)
```
##### 2-2-2. Y~X2
```{r}
lm2<-lm(Y~X2, data=bodyfat)
coef(summary(lm2))
anova(lm2)
```
##### 2-2-3. Y~X1+X2
```{r}
lm3<-lm(Y~X1+X2, data=bodyfat)
coef(summary(lm3))
anova(lm3)
```
##### 2-2-4. Y~X1+X2+X3
```{r}
lm4<-lm(Y~X1+X2+X3, data=bodyfat)
coef(summary(lm4))
anova(lm4)
```

## 3. 선형 회귀 모델 비교

#### 3-1. lm3 vs lm4
```{r}

anova(lm3, lm4)

```
- p-value는 0.1896입니다. 이 값은 F 통계량에 대한 p-value를 나타냅니다. 여기서는 유의수준 0.05보다 크기 때문에 X3을 추가하여 모델이 향상되었다고 말할 수는 없습니다. 따라서 X3을 추가하여 모델을 개선하는 것은 유의하지 않다


#### 3-2. lm1 vs lm4
```{r}

anova(lm1, lm4)

```
- F 통계량의 p-값이 0.04995로, 이는 유의수준 0.05보다 작기 때문에 *로 표시됩니다. 따라서 모델 2가 모델 1보다 종속 변수 Y를 설명하는 데 통계적으로 유의하게 더 적합하다는 것을 나타냅니다.
- 즉, X2와 X3을 추가한 모델 2가 X1만을 포함한 모델 1보다 Y를 설명하는 데 더 나은 모델입니다.



## 4. 합성 변수를 사용한 모델 비교
#### 4-1. X12 = X1+X2

```{r}
bodyfat$X12<-bodyfat$X1+bodyfat$X2

lm5<-lm(Y~X12+X3, data=bodyfat)

anova(lm5, lm4)
```

#### 4-2. GLH 검정
```{r}
library(gmodels)
glh.test(lm4, cm=c(0, 1, -1, 0))
```
- p-값이 0.2171로 유의수준인 0.05보다 크므로, X1과 X2를 개별적으로 추가하는 것이 X12를 사용하는 것보다 모델을 개선하는 데에는 통계적으로 유의미한 차이가 없다는 것을 나타냅니다.

- lm4 모델에서 X1과 X2의 회귀 계수가 동일한지 검정하는 일반 선형 가설 검정 (GLH 테스트)을 수행합니다.
- p-값이 0.05보다 크므로, 귀무가설 
H0(즉,𝛽1−𝛽2 = 0)을 기각할 수 없습니다.
- 이는 X1과 X2의 회귀 계수가 유의미하게 다르지 않다는 것을 의미합니다.


## 5. 회귀 계수를 계산하는 3가지 방법
#### 5-1. 일반 선형 회귀(Ordinary Linear Regression)

- 최소제곱법(OLS)을 사용하여 회귀계수를 추정
- 절편 포함 가능
- 데이터 단위 그대로 사용
- 가장 직관적이나 다중공선성에 민감하고 변수 단위가 다르면 계수 비교 어려움
```{r}
lm.bodyfat <- lm(Y~X1+X2, data=bodyfat)
lm.bodyfat
```

#### 5-2. 표준화 회귀(Standardized regression)
- Y와 X를 모두 표준화(z-score)
- 절편 제거 (0 +)
- 단위에 상관없이 변수 영향력 비교 가능
- 변수 간 영향력 비교 가능하나 절편 정보가 손실되어 실제 값 단위로 해석 불가
```{r}
lm(scale(Y)~0+scale(X1)+scale(X2), data=bodyfat)
```

#### 5-3. 상관행렬 이용 계산(Correlation Matrix Method)
- X의 상관행렬과 Y-X 상관행렬 이용
- 수학적으로 계수 산출 과정이 명확이 드러나고, 적은 변수에서 직관적이나 변수 개수가 많으면 계산이 어렵고 절편 포함 시 별도 처리가 필요
```{r}
# step1) X1과 X2의 상관행렬 Rxx
Rxx<-cor(cbind(bodyfat$X1, bodyfat$X2))

# step2) Y와 X1,X2의 상관행렬 Ryx
Ryx<-rbind(cor(bodyfat$Y, bodyfat$X1), cor(bodyfat$Y, bodyfat$X2))

# step3) Rxx-1*Ryx를 행렬 연산
solve(Rxx)%*%Ryx
```

## The End
